<html> 
  <body>   
    <div class="wrapper" >
      <form class="login">
        <p class="title">
          <i class="bi bi-key-fill"></i>
          {{ isInRegistrationMode ? 'Registro de Usuario' : 'Passkeys Login' }}
        </p>

        <div class="input-group">
          <i class="bi bi-person"></i>
          <input 
            type="email" 
            [(ngModel)]="username" 
            name="username" 
            placeholder="Email" 
            autocomplete="username webauthn"
            id="username"
            (focus)="onUsernameFieldFocus()"
            (click)="onUsernameFieldFocus()"
            #usernameInput/>
        </div>

        <!-- Campo de contraseña para registro -->
        <div class="input-group" *ngIf="isInRegistrationMode">
          <i class="bi bi-lock"></i>
          <input 
            type="password" 
            [(ngModel)]="password" 
            name="password" 
            placeholder="Password" />
        </div>
        
        <!-- Campo de contraseña para login (siempre visible en modo login) -->
        <div class="input-group" *ngIf="!isInRegistrationMode">
          <i class="bi bi-lock"></i>
          <input 
            type="password" 
            [(ngModel)]="password" 
            name="password" 
            placeholder="Password" />
        </div>


        <div class="buttons-container">
          <!-- Si estamos en modo registro y ya se muestra el campo de contraseña -->
          <button 
            *ngIf="isInRegistrationMode"
            class="btn-direct-auth" 
            (click)="registerWithPassword()"
            [disabled]="isRegistering">
            <i *ngIf="!isRegistering" class="bi bi-person-plus"></i>
            <span *ngIf="isRegistering" class="spinner-border spinner-border-sm"></span>
            <span>{{ isRegistering ? 'Registrando...' : 'Registrar con contraseña' }}</span>
          </button>
          
          <!-- Si NO estamos en modo registro - Botón para passkey -->
          <button 
            *ngIf="!isInRegistrationMode"
            class="btn-direct-auth" 
            (click)="directAuthentication()"
            [disabled]="isAuthenticating">
            <i *ngIf="!isAuthenticating" class="bi bi-key"></i>
            <span *ngIf="isAuthenticating" class="spinner-border spinner-border-sm"></span>
            <span>{{ isAuthenticating ? 'Loading...' : 'Log in with Passkey' }}</span>
          </button>
          
          <!-- Si estamos en modo registro -->
          <button 
            *ngIf="isInRegistrationMode"
            class="btn-auth" 
            (click)="register()"
            [disabled]="isRegistering">
            <i *ngIf="!isRegistering" class="bi bi-key"></i>
            <span *ngIf="isRegistering" class="spinner-border spinner-border-sm"></span>
            <span>{{ isRegistering ? 'Registrando...' : 'Registrar con passkey' }}</span>
          </button>
          
          <!-- Si NO estamos en modo registro - Botón para login con contraseña -->
          <button 
            *ngIf="!isInRegistrationMode"
            class="btn-auth" 
            (click)="loginConContra()"
            [disabled]="isAuthenticating">
            <i *ngIf="!isAuthenticating" class="bi bi-person-lock"></i>
            <span *ngIf="isAuthenticating" class="spinner-border spinner-border-sm"></span>
            <span>{{ isAuthenticating ? 'Loading...' : 'Log in' }}</span>
          </button>
        </div>
        
        <div class="links-container">
          <a (click)="toggleRegistrationMode()">
            {{ isInRegistrationMode ? 'Ya dispones de una cuenta? Logueate' : 'No tienes cuenta? REGISTRATE' }}
          </a>
          <hr>
          <a *ngIf="!isInRegistrationMode" >Perdiste la cuenta? Recupérala</a>
        </div>
        
        <div *ngIf="errorMessage" class="error-message" [class.success]="errorMessage.includes('exitoso')">
          <i class="bi" [ngClass]="errorMessage.includes('exitoso') ? 'bi-check-circle' : 'bi-exclamation-triangle'"></i>
          {{ errorMessage }}
        </div>
      </form>
    </div>
  </body>
</html>